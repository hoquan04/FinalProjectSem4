@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
<nav class="navbar-default navbar-static-side" role="navigation">
    <div class="sidebar-collapse">
        <ul class="nav metismenu" id="side-menu">
            <li class="nav-header">
                <div class="dropdown profile-element">
                    <span>
                        <img alt="image" class="img-circle" src="/admin/img/profile_small.jpg" />
                    </span>
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                        <span class="clear">
                            <span class="block m-t-xs">
                                @if (User.Identity.IsAuthenticated)
                                {
                                    <strong class="font-bold">Xin chào, @User.Identity.Name</strong>
                                }

                                <span class="text-muted text-xs block">
                                    @HttpContextAccessor.HttpContext.Session.GetString("AdminName") 
                                    <b class="caret"></b>
                                </span>
                        </span>
                    </a>
                    <ul class="dropdown-menu animated fadeInRight m-t-xs">
                        <li class="nav-item">
                            <a class="nav-link" asp-area="Admin" asp-controller="Profile" asp-action="Index">
                                <i class="bi bi-person-circle"></i> Hồ sơ
                            </a>
                        </li>
                  
                        <li><a asp-action="Logout" asp-controller="Account" onclick="return confirm('Bạn có chắc chắn muốn đăng xuất không?');">Đăng xuất</a></li>
                    </ul>
                </div>
                <div class="logo-element">
                    IN+
                </div>
            </li>
            <!--Start Sidebar-->
        
             <li>
                <a asp-action="Index" asp-controller="Dashboard"><i class="fa fa-th-large"></i> <span class="nav-label">Trang chủ</span></a>
            </li>
            <li>
                <a asp-action="Index" asp-controller="Category"><i class="fa fa-diamond"></i> <span class="nav-label">Danh mục</span></a>
            </li>
          @*   <li>
                <a asp-action="Index" asp-controller="Brand"><i class="fa fa-sitemap"></i> <span class="nav-label">Brands</span></a>
            </li> *@
            <li class="has-submenu">
                <a href="#"><i class="fa fa-bar-chart-o"></i> <span class="nav-label">Products</span><span class="fa arrow"></span></a>
                <ul class="nav nav-second-level collapse">
                    <li><a asp-action="Index" asp-controller="Product">Danh sách sản phẩm</a></li>
                    <li><a asp-action="Create" asp-controller="Product">Tạo sản phẩm</a></li>
                </ul>
            </li>
         <li>
                <a asp-action="Index" asp-controller="Order"><i class="fa fa-shopping-cart"></i> <span class="nav-label">Đơn hàng</span></a>
            </li>

			<li>
                <a asp-action="Index" asp-controller="User"><i class="fa fa-database"></i> <span class="nav-label">Tài khoản</span></a>
			</li>

			<li>
                <a asp-action="Index" asp-controller="Payment"><i class="fa fa-magic"></i> <span class="nav-label">Thanh toán</span></a>
			</li>
            <li>
                <a asp-action="Index" asp-controller="Review"><i class="fa fa-laptop"></i> <span class="nav-label">Đánh giá</span></a>
            </li>
            <li>
                <a asp-action="Index" asp-controller="Shipping"><i class="fa fa-files-o"></i> <span class="nav-label">Giao hàng</span></a>
            </li>
     

            <!--End Sidebar-->
        </ul>
    </div>
</nav>

@section Styles {
    <style>
        .nav > li.active > a {
            background-color: #1ab394;
            color: white !important;
        }

        .nav > li.special_link.active > a {
            background-color: #1ab394;
            color: white !important;
        }

        .nav > li > a:hover {
            background-color: #1ab394;
            color: white !important;
        }

        /* Thêm style cho submenu item active */
        .nav.nav-second-level > li.active > a {
            background-color: #18a689;
            color: white !important;
        }
    </style>
}

@section Scripts {
    <script>
        $(document).ready(function () {
            // Khởi tạo metisMenu
            $('#side-menu').metisMenu({
                toggle: true,
                activeClass: 'active'
            });

            // Lấy đường dẫn hiện tại (loại bỏ query string và hash nếu có)
            var currentPath = window.location.pathname.toLowerCase().split(/[?#]/)[0];
            console.log('Current path:', currentPath);

            $('#side-menu > li').each(function () {
                var menuItem = $(this);
                var link = menuItem.find('> a').attr('href');

                if (!link) return;

                // Kiểm tra menu item không có submenu
                if (!menuItem.hasClass('has-submenu')) {
                    var menuPath = link.toLowerCase().split(/[?#]/)[0];
                    console.log('Checking menu:', menuItem.find('> a').text().trim(), 'Path:', menuPath);

                    // Kiểm tra nếu đường dẫn hiện tại khớp với link menu
                    if (currentPath === menuPath) {
                        menuItem.addClass('active');
                        console.log('Activated menu:', menuItem.find('> a').text().trim());
                        return false;
                    }
                }

                // Kiểm tra các submenu item
                menuItem.find('ul li a').each(function () {
                    var subLink = $(this).attr('href');
                    if (subLink) {
                        var subMenuPath = subLink.toLowerCase().split(/[?#]/)[0];
                        console.log('Checking submenu:', $(this).text().trim(), 'Path:', subMenuPath);

                        if (currentPath === subMenuPath) {
                            menuItem.addClass('active');
                            $(this).parent().addClass('active');
                            console.log('Activated submenu:', $(this).text().trim());
                            return false;
                        }
                    }
                });
            });

            // Xử lý khi click vào menu item
            $('#side-menu > li > a').on('click', function (e) {
                // Nếu là menu có submenu thì không xử lý chuyển trang
                if ($(this).parent().hasClass('has-submenu')) {
                    e.preventDefault();
                }

                // Xóa active class từ tất cả các menu item
                $('#side-menu > li').removeClass('active');
                $('#side-menu .nav-second-level > li').removeClass('active');

                // Thêm active class cho menu item được click
                $(this).parent().addClass('active');
            });
        });
    </script>
}
