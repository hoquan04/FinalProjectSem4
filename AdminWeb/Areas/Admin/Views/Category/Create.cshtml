@model AdminWeb.Areas.Admin.Models.CategoryCreateModel
@{
    ViewData["Title"] = "Th√™m danh m·ª•c m·ªõi";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="row justify-content-center">
    <div class="col-lg-12 col-md-12 col-sm-12">
        <div class="ibox">
            <div class="ibox-title">
                <h5>@ViewData["Title"]</h5>
                <div class="ibox-tools">
                    <a asp-action="Index" class="btn btn-sm btn-secondary">
                        <i class="fa fa-arrow-left"></i> Quay l·∫°i danh s√°ch
                    </a>
                </div>
            </div>
            <div class="ibox-content">
                
                @* Form ƒë·ªÉ POST API *@
                <form asp-action="Create" method="post" class="form-horizontal">
                    @* Anti-forgery token *@
                    @Html.AntiForgeryToken()
                    
                    @* Validation summary - hi·ªÉn th·ªã l·ªói chung *@
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    
                    @* Tr∆∞·ªùng T√™n danh m·ª•c *@
                    <div class="form-group">
                        <label asp-for="Name" class="col-sm-2 control-label"></label>
                        <div class="col-sm-10">
                            <input asp-for="Name" class="form-control" 
                                   placeholder="Nh·∫≠p t√™n danh m·ª•c (v√≠ d·ª•: ƒêi·ªán tho·∫°i, Laptop...)">
                            <span asp-validation-for="Name" class="text-danger"></span>
                        </div>
                    </div>

                    @* Tr∆∞·ªùng M√¥ t·∫£ *@      
                    <div class="form-group">
                        <label asp-for="Description" class="col-sm-2 control-label"></label>
                        <div class="col-sm-10">
                            <textarea asp-for="Description" class="form-control" rows="4" 
                                      placeholder="Nh·∫≠p m√¥ t·∫£ cho danh m·ª•c (kh√¥ng b·∫Øt bu·ªôc)"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="hr-line-dashed"></div>
                    
                    @* Buttons *@
                    <div class="form-group">
                        <div class="col-sm-4 col-sm-offset-2">
                            <button type="submit" class="btn btn-primary" id="btnSubmit">
                                <i class="fa fa-save"></i> L∆∞u danh m·ª•c
                            </button>
                            <a asp-action="Index" class="btn btn-default">
                                <i class="fa fa-times"></i> H·ªßy
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        console.log('üîß Create script loaded');
        
        // JavaScript ƒë·ªÉ show loading khi submit
        $('#btnSubmit').click(function(e) {
            e.preventDefault(); // NgƒÉn submit m·∫∑c ƒë·ªãnh
            
            console.log('üñ±Ô∏è Submit button clicked');
            
            var $btn = $(this);
            var $form = $btn.closest('form');
            
            // Ki·ªÉm tra validation tr∆∞·ªõc khi submit
            if (!$form.valid()) {
                console.log('‚ùå Form validation failed');
                return false;
            }
            
            console.log('‚úÖ Form validation passed');
            console.log('üöÄ Submitting form to:', $form.attr('action'));
            
            // Show loading state
            $btn.prop('disabled', true)
                .html('<i class="fa fa-spinner fa-spin"></i> ƒêang g·ª≠i API...');
            
            // Submit form manually
            $form.submit();
        });
        
        // Log form submit event
        $('form').on('submit', function(e) {
            console.log('üì§ Form is being submitted');
            console.log('üéØ Form action:', $(this).attr('action'));
            console.log('üéØ Form method:', $(this).attr('method'));
            
            // Log form data
            var formData = new FormData(this);
            console.log('üìã Form data:');
            for (var pair of formData.entries()) {
                console.log('   ' + pair[0] + ': ' + pair[1]);
            }
        });
        
        // Reset button n·∫øu c√≥ l·ªói validation
        $('form').on('invalid-form.validate', function() {
            console.log('‚ùå Form validation failed - resetting button');
            $('#btnSubmit').prop('disabled', false)
                          .html('<i class="fa fa-save"></i> L∆∞u danh m·ª•c');
        });
        
        // Th√™m timeout ƒë·ªÉ reset button n·∫øu qu√° l√¢u
        var submitTimeout;
        $('form').on('submit', function() {
            submitTimeout = setTimeout(function() {
                $('#btnSubmit').prop('disabled', false)
                              .html('<i class="fa fa-save"></i> L∆∞u danh m·ª•c');
                alert('Thao t√°c m·∫•t qu√° nhi·ªÅu th·ªùi gian. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi API v√† th·ª≠ l·∫°i.');
            }, 30000); // 30 gi√¢y timeout
        });
        
        // Clear timeout khi page unload
        $(window).on('beforeunload', function() {
            if (submitTimeout) {
                clearTimeout(submitTimeout);
            }
        });
    </script>
}
