@model AdminWeb.Areas.Admin.Models.PagedResponse<AdminWeb.Areas.Admin.Models.UserViewModel>

@{
	ViewData["Title"] = "Danh sách người dùng";
	Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";

	var pageNow = (Model?.PageNow ?? 1) > 0 ? Model!.PageNow : 1;
	var pageSize = (Model?.PageSize ?? 10) > 0 ? Model!.PageSize : 10;
	var totalPage = Model?.TotalPage ?? 0;
	var totalCount = Model?.TotalCount ?? 0;

	var stt = (pageNow - 1) * pageSize + 1;
}

<div class="col-lg-12">
	<div class="ibox-content">

		@* Thông báo *@
		@if (TempData["SuccessMessage"] != null)
		{
			<div class="alert alert-success alert-dismissable">
				<button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
				<i class="fa fa-check"></i> @TempData["SuccessMessage"]
			</div>
		}
		@if (TempData["ErrorMessage"] != null)
		{
			<div class="alert alert-danger alert-dismissable">
				<button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
				<i class="fa fa-times"></i> @TempData["ErrorMessage"]
			</div>
		}
		@if (!string.IsNullOrEmpty(ViewBag.Error))
		{
			<div class="alert alert-danger mt-3">
				<strong><i class="fa fa-exclamation-triangle"></i> @ViewBag.Error</strong>
			</div>
		}

		<div class="row">
			<form asp-action="Index" method="get" class="w-100">
				<div class="col-sm-4">
					<div class="input-group">
						<input type="text" name="searchString" value="@ViewBag.SearchString" placeholder="Tìm kiếm..." class="input-sm form-control" />
						<span class="input-group-btn">
							<button type="submit" class="btn btn-sm btn-primary">
								<i class="fa fa-search"></i> Tìm kiếm
							</button>
						</span>
					</div>
				</div>

				<div class="col-sm-8 text-right">
					<a asp-action="Create" class="btn btn-primary">
						<i class="fa fa-plus"></i> Thêm mới
					</a>
					@if (!string.IsNullOrEmpty(ViewBag.SearchString))
					{
						<a asp-action="Index" class="btn btn-secondary">
							<i class="fa fa-list"></i> Xem tất cả
						</a>
					}
				</div>
			</form>
		</div>

		<div class="table-responsive mt-3">
			<table class="table table-striped">
				<thead>
					<tr>
						<th>STT</th>
						<th>ID</th>
						<th>Họ và tên</th>
						<th>Email</th>
						<th>Số điện thoại</th>
						<th>Địa chỉ</th>
						<th>Vai trò</th>
						<th>Ngày tạo</th>
						<th>Thao tác</th>
					</tr>
				</thead>
				<tbody>
					@if (Model?.Data != null && Model.Data.Any())
					{
						foreach (var item in Model.Data)
						{
							<tr>
								<td>@(stt++)</td>
								<td><span class="badge badge-primary">@item.UserId</span></td>
								<td>@item.FullName</td>
								<td>@item.Email</td>
								<td>@item.Phone</td>
								<td>@item.Address</td>
								<td>
									@if (item.Role == AdminWeb.Areas.Admin.Models.UserRole.Admin)
									{
										<span class="badge badge-danger">Admin</span>
									}
									else
									{
										<span class="badge badge-primary">Customer</span>
									}
								</td>
								<td>@item.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
								<td>
									<div class="btn-group" role="group">
										<a asp-action="Edit" asp-route-id="@item.UserId" class="btn btn-sm btn-warning" title="Chỉnh sửa">
											<i class="fa fa-edit"></i> Sửa
										</a>
										<a asp-action="Delete" asp-route-id="@item.UserId" class="btn btn-sm btn-danger" title="Xóa"
										   onclick="return confirm('Bạn có chắc chắn muốn xóa người dùng này?');">
											<i class="fa fa-trash"></i> Xóa
										</a>
									</div>
								</td>
							</tr>
						}
					}
					else
					{
						<tr>
							<td colspan="9" class="text-center py-4">
								@if (!string.IsNullOrEmpty(ViewBag.SearchString))
								{
									<div class="alert alert-info">
										<i class="fa fa-info-circle"></i>
										Không tìm thấy người dùng nào phù hợp với từ khóa "<strong>@ViewBag.SearchString</strong>"
									</div>
								}
								else
								{
									<div class="alert alert-info">
										<i class="fa fa-info-circle"></i>
										Chưa có người dùng nào.
										<a asp-action="Create" class="btn btn-sm btn-primary">
											<i class="fa fa-plus"></i> Thêm người dùng đầu tiên
										</a>
									</div>
								}
							</td>
						</tr>
					}
				</tbody>
			</table>
		</div>

		<div class="row mt-3">
			<div class="col-sm-6">
				<small class="text-muted">
					<i class="fa fa-info-circle"></i>
					Hiển thị <strong>@(Model?.Data?.Count() ?? 0)</strong>/<strong>@totalCount</strong> người dùng
					@if (!string.IsNullOrEmpty(ViewBag.SearchString))
					{
						<span>cho từ khóa "<strong>@ViewBag.SearchString</strong>"</span>
					}
				</small>
			</div>

			<div class="col-sm-6">
				@if (totalPage > 1)
				{
					<nav class="float-right">
						<ul class="pagination mb-0">
							<li class="page-item @(pageNow == 1 ? "disabled" : "")">
								<a class="page-link"
								   asp-action="Index"
								   asp-route-searchString="@ViewBag.SearchString"
								   asp-route-page="@(pageNow - 1)"
								   asp-route-pageSize="@(pageSize)">«</a>
							</li>

							@for (int p = 1; p <= totalPage; p++)
							{
								<li class="page-item @(p == pageNow ? "active" : "")">
									<a class="page-link"
									   asp-action="Index"
									   asp-route-searchString="@ViewBag.SearchString"
									   asp-route-page="@p"
									   asp-route-pageSize="@(pageSize)">@p</a>
								</li>
							}

							<li class="page-item @(pageNow == totalPage ? "disabled" : "")">
								<a class="page-link"
								   asp-action="Index"
								   asp-route-searchString="@ViewBag.SearchString"
								   asp-route-page="@(pageNow + 1)"
								   asp-route-pageSize="@(pageSize)">»</a>
							</li>
						</ul>
					</nav>
				}
			</div>
		</div>

	</div>
</div>
